<div class="container-fluid py-4">
  <!-- Header Section -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
          <h2 class="page-title mb-1">Create New Service Request</h2>
          <p class="text-muted mb-0">Fill in the details to create a new service request</p>
        </div>
        <button class="btn btn-outline-primary" routerLink="/ServiceProvider/ClientRequests">
          <i class="fas fa-arrow-left me-2"></i>Go to Your Requests
        </button>
      </div>
    </div>
  </div>

  <!-- Form Section -->
  <div class="row justify-content-center">
    <div class="col-lg-8 col-xl-6">
      <div class="form-card">
        <div class="form-header">
          <div class="header-icon">
            <i class="fas fa-plus-circle"></i>
          </div>
          <h3 class="header-title">Service Request Details</h3>
          <p class="header-subtitle">Provide information about your service needs</p>
        </div>

        <div class="form-body">
          <form [formGroup]="requestForm" (ngSubmit)="onSubmit()" enctype="multipart/form-data">
            
            <!-- Title Field -->
            <div class="form-group">
              <label for="title" class="form-label">
                <i class="fas fa-heading me-2"></i>Request Title
              </label>
              <input 
                type="text" 
                class="form-control" 
                id="title" 
                formControlName="title"
                placeholder="Enter a descriptive title for your request"
                [class.is-invalid]="requestForm.get('title')?.touched && requestForm.get('title')?.invalid">
              <div class="invalid-feedback" *ngIf="requestForm.get('title')?.errors?.['required']">
                <i class="fas fa-exclamation-circle me-1"></i>Title is required
              </div>
            </div>

            <!-- Category Field -->
            <div class="form-group">
              <label for="CategoryServicesId" class="form-label">
                <i class="fas fa-tags me-2"></i>Service Category
              </label>
              <select 
                class="form-select" 
                id="CategoryServicesId" 
                formControlName="CategoryServicesId"
                [class.is-invalid]="requestForm.get('CategoryServicesId')?.touched && requestForm.get('CategoryServicesId')?.invalid">
                <option value="">Choose a service category</option>
                <option *ngFor="let category of categories" [value]="category.Id">
                  {{ category.Name }}
                </option>
              </select>
              <div class="invalid-feedback" *ngIf="requestForm.get('CategoryServicesId')?.errors?.['required']">
                <i class="fas fa-exclamation-circle me-1"></i>Service category is required
              </div>
            </div>

            <!-- Description Field -->
            <div class="form-group">
              <label for="description" class="form-label">
                <i class="fas fa-align-left me-2"></i>Description
              </label>
              <textarea 
                class="form-control" 
                id="description" 
                rows="4" 
                formControlName="description"
                placeholder="Describe your service requirements in detail..."
                [class.is-invalid]="requestForm.get('description')?.touched && requestForm.get('description')?.invalid">
              </textarea>
              <div class="character-count">
                <small class="text-muted">
                  {{ requestForm.get('description')?.value?.length || 0 }}/500 characters
                </small>
              </div>
              <div class="invalid-feedback" *ngIf="requestForm.get('description')?.errors?.['required']">
                <i class="fas fa-exclamation-circle me-1"></i>Description is required
              </div>
              <div class="invalid-feedback" *ngIf="requestForm.get('description')?.errors?.['maxlength']">
                <i class="fas fa-exclamation-circle me-1"></i>Description cannot exceed 500 characters
              </div>
            </div>

            <!-- Due Date and Budget Row -->
            <div class="row">
              <div class="col-md-6">
                <div class="form-group">
                  <label for="dueDate" class="form-label">
                    <i class="fas fa-calendar-alt me-2"></i>Preferred Date
                  </label>
                  <input 
                    type="date" 
                    class="form-control" 
                    id="dueDate" 
                    formControlName="dueDate"
                    [class.is-invalid]="requestForm.get('dueDate')?.touched && requestForm.get('dueDate')?.invalid">
                  <div class="invalid-feedback" *ngIf="requestForm.get('dueDate')?.errors?.['required']">
                    <i class="fas fa-exclamation-circle me-1"></i>Preferred date is required
                  </div>
                  <div class="invalid-feedback" *ngIf="requestForm.get('dueDate')?.errors?.['dateInPast']">
                    <i class="fas fa-exclamation-circle me-1"></i>Date cannot be in the past
                  </div>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-group">
                  <label for="startPrice" class="form-label">
                    <i class="fas fa-dollar-sign me-2"></i>Budget (EGP)
                  </label>
                  <div class="input-group">
                    <span class="input-group-text">Â£</span>
                    <input 
                      type="number" 
                      step="0.01" 
                      class="form-control" 
                      id="startPrice" 
                      formControlName="startPrice"
                      placeholder="0.00"
                      [class.is-invalid]="requestForm.get('startPrice')?.touched && requestForm.get('startPrice')?.invalid">
                  </div>
                  <div class="invalid-feedback" *ngIf="requestForm.get('startPrice')?.errors?.['required']">
                    <i class="fas fa-exclamation-circle me-1"></i>Budget is required
                  </div>
                  <div class="invalid-feedback" *ngIf="requestForm.get('startPrice')?.errors?.['min']">
                    <i class="fas fa-exclamation-circle me-1"></i>Budget must be greater than 0
                  </div>
                </div>
              </div>
            </div>

            <!-- Address Field -->
            <div class="form-group">
              <label for="address" class="form-label">
                <i class="fas fa-map-marker-alt me-2"></i>Service Address
              </label>
              <input 
                type="text" 
                class="form-control" 
                id="address" 
                formControlName="address"
                placeholder="Enter the complete address where service is needed"
                [class.is-invalid]="requestForm.get('address')?.touched && requestForm.get('address')?.invalid">
              <div class="invalid-feedback" *ngIf="requestForm.get('address')?.errors?.['required']">
                <i class="fas fa-exclamation-circle me-1"></i>Address is required
              </div>
            </div>

            <!-- Image Upload Field -->
            <div class="form-group">
              <label for="image" class="form-label">
                <i class="fas fa-image me-2"></i>Upload Image
              </label>
              <div class="upload-container">
                <input 
                  type="file" 
                  class="form-control" 
                  id="image" 
                  (change)="onFileChange($event)"
                  [class.is-invalid]="imageTouched && !imageValid" 
                  accept="image/*">
                <div class="upload-help">
                  <i class="fas fa-upload me-2"></i>
                  <span>Choose an image file (JPG, PNG, GIF) - Optional</span>
                </div>
              </div>
              <div class="invalid-feedback" *ngIf="imageTouched && !imageValid">
                <i class="fas fa-exclamation-circle me-1"></i>Please upload a valid image file
              </div>
            </div>

            <!-- Action Buttons -->
            <div class="form-actions">
              <div class="d-flex flex-column flex-sm-row gap-3 justify-content-end">
                <button 
                  type="button" 
                  class="btn btn-outline-secondary" 
                  routerLink="/client-requests">
                  <i class="fas fa-times me-2"></i>Cancel
                </button>
                <button 
                  type="submit" 
                  class="btn btn-primary btn-submit" 
                  [disabled]="isLoading || requestForm.invalid || !imageValid">
                  <span *ngIf="!isLoading">
                    <i class="fas fa-paper-plane me-2"></i>Submit Request
                  </span>
                  <span *ngIf="isLoading">
                    <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                    Submitting...
                  </span>
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>