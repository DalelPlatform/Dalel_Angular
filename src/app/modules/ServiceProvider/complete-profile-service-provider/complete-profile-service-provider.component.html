<div id="container" class="container mt-5">
  <div class="contents">
    <div class="progress px-1" style="height: 3px;">
      <div class="progress-bar" role="progressbar" [style.width.%]="progressPercentage"
        [attr.aria-valuenow]="progressPercentage" aria-valuemin="0" aria-valuemax="100">
      </div>
    </div>

    <div class="step-container d-flex justify-content-between my-3">
      @for (step of steps; let i = $index; track $index) {
      <div class="step-circle" [class.active]="currentStep === i + 1" (click)="displayStep(i + 1)">
        {{ i + 1 }}
      </div>
      }
    </div>
  </div>

  <form [formGroup]="profileForm" (ngSubmit)="onSubmit()">
    @if (currentStep === 1) {
    <h3 class="mb-4">Step 1: Business Location</h3>
    <div class="labeled-input">
      <label class="form-label">Country *</label>
      <input formControlName="country" placeholder="Select country" />
      <span class="text-danger" *ngIf="profileForm.get('country')?.touched && profileForm.get('country')?.invalid">
        Country is required
      </span>

      <label class="form-label">City *</label>
      <input formControlName="city" placeholder="Select city" />
      <span class="text-danger" *ngIf="profileForm.get('city')?.touched && profileForm.get('city')?.invalid">
        City is required
      </span>

      <label class="form-label">District *</label>
      <input formControlName="district" placeholder="Select district" />
      <span class="text-danger" *ngIf="profileForm.get('district')?.touched && profileForm.get('district')?.invalid">
        District is required
      </span>

      <label class="form-label">Zip Code *</label>
      <input formControlName="zipCode" placeholder="Zip code" />
      <span class="text-danger" *ngIf="profileForm.get('zipCode')?.touched && profileForm.get('zipCode')?.invalid">
        Zip code is required
      </span>

      <label class="form-label">Address Line *</label>
      <input formControlName="addressLine" placeholder="Address line" />
      <span class="text-danger" *ngIf="profileForm.get('addressLine')?.touched && profileForm.get('addressLine')?.invalid">
        Address line is required
      </span>

      <label class="form-label">Service Areas *</label>
      <input formControlName="serviceAreas" placeholder="Search area where you provide your services" />
      <span class="text-danger" *ngIf="profileForm.get('serviceAreas')?.touched && profileForm.get('serviceAreas')?.invalid">
        Service areas are required
      </span>
      <button type="button" class="btn btn-primary" (click)="nextStep()">Next</button>
    </div>
    }
    
@if (currentStep === 2) {
<h3 class="mb-4">Step 2: Choose Category</h3>
<div class="labeled-input">
  <label class="form-label">Categories *</label>
  <select formControlName="categories" class="form-select">
    <option value="">Select a category</option>
    @for (category of categoriesList; track category) {
    <option [value]="category">{{ category }}</option> <!-- Display the category name directly -->
    }
  </select>
  <span class="text-danger" *ngIf="profileForm.get('categories')?.touched && profileForm.get('categories')?.invalid">
    Category is required
  </span>

  <div class="d-flex">
    <button type="button" class="btn btn-primary me-2" (click)="prevStep()">Previous</button>
    <button type="button" class="btn btn-primary" (click)="nextStep()">Next</button>
  </div>
</div>
}

    @if (currentStep === 3) {
    <h3 class="mb-4">Step 3: Profile Details</h3>
    <div class="labeled-input">
      <label class="form-label">Profile Photo *</label>
      <input type="file" (change)="onFileChange($event, 'image')" accept="image/png, image/jpeg" />
      <span class="text-danger" *ngIf="profileForm.get('image')?.touched && profileForm.get('image')?.invalid">
        Profile photo is required
      </span>

      <label class="form-label">About You and Your Business</label>
      <textarea formControlName="about" placeholder="Tell potential customers about yourself and your business" rows="4"></textarea>
      <span class="text-danger" *ngIf="profileForm.get('about')?.touched && profileForm.get('about')?.invalid">
        About section is required and must be at least 50 characters
      </span>

      <label class="form-label">Website</label>
      <input formControlName="website" placeholder="https://" />
      <span class="text-danger" *ngIf="profileForm.get('website')?.touched && profileForm.get('website')?.invalid">
        Website must be a valid URL
      </span>
      <div class="d-flex">
        <button type="button" class="btn btn-primary me-2" (click)="prevStep()">Previous</button>
        <button type="button" class="btn btn-primary" (click)="nextStep()">Next</button>
      </div>
    </div>
    }

    @if (currentStep === 4) {
    <h3 class="mb-4">Step 4: Price and Hours</h3>
    <div class="labeled-input">
      <label class="form-label">Price *</label>
      <div class="input-group">
        <span class="input-group-text">$</span>
        <input formControlName="price" type="number" placeholder="Set a fair price" />
        <select formControlName="priceUnit" class="form-select">
          <option value="per_hour">per hour</option>
        </select>
      </div>
      <span class="text-danger" *ngIf="profileForm.get('price')?.touched && profileForm.get('price')?.invalid">
        Price is required and must be greater than 0
      </span>

      <label class="form-label">Working Hours</label>
      <div formArrayName="schedules">
        @for (schedule of schedules.controls; let i = $index; track $index) {
        <div [formGroupName]="i" class="d-flex align-items-center mb-2">
          <div class="form-check form-switch me-2">
            <input type="checkbox" formControlName="enabled" [id]="'day-' + i" class="form-check-input" />
            <label [for]="'day-' + i" class="form-check-label">{{ ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'][i] }}</label>
          </div>
          <select formControlName="availableFrom" class="form-select me-2" [disabled]="!schedule.get('enabled')?.value">
            <option *ngFor="let hour of getHours()" [value]="hour">{{ hour }}</option>
          </select>
          <span>to</span>
          <select formControlName="availableTo" class="form-select" [disabled]="!schedule.get('enabled')?.value">
            <option *ngFor="let hour of getHours()" [value]="hour">{{ hour }}</option>
          </select>
        </div>
        }
      </div>
      <div class="d-flex">
        <button type="button" class="btn btn-primary me-2" (click)="prevStep()">Previous</button>
        <button type="submit" class="btn btn-primary">Save Profile</button>
      </div>
    </div>
    }

    <div *ngIf="saveError" class="alert alert-danger mt-3">{{ saveError }}</div>
  </form>
</div>