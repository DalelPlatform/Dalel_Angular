<!-- Enhanced Projects List Template -->
<div class="container-fluid py-4">
    <!-- Header Section -->
    <div class="header-section">
        <div class="header-content">
            <h2 class="page-title">
                <i class="bi bi-folder-plus me-2"></i>Your Projects
            </h2>
            <p class="page-subtitle">Manage and organize your service projects</p>
        </div>

    </div>

    <!-- Loading State -->
    <div *ngIf="isInitializing" class="loading-state">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-3">Initializing your projects...</p>
    </div>

    <!-- Main Content -->
    <div *ngIf="!isInitializing">
        <!-- Search and Controls -->
        <div class="search-controls-card">
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col-md-6">
                        <div class="search-input-group">
                            <span class="search-icon">
                                <i class="bi bi-search"></i>
                            </span>
                            <input type="text" class="search-input"
                                placeholder="Search projects by name or description..." [(ngModel)]="searchTerm"
                                (input)="onSearchChange()" />
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="sort-buttons">
                            <button class="sort-btn" (click)="changeSort('name')"
                                [class.active]="sortBy === 'name'">
                                <i class="bi" [ngClass]="getSortIcon('name')"></i>
                                Name
                            </button>
                            <button class="sort-btn" (click)="changeSort('price')"
                                [class.active]="sortBy === 'price'">
                                <i class="bi" [ngClass]="getSortIcon('price')"></i>
                                Price
                            </button>
                            <button class="sort-btn" (click)="changeSort('date')"
                                [class.active]="sortBy === 'date'">
                                <i class="bi" [ngClass]="getSortIcon('date')"></i>
                                Date
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Results Info -->
        <div class="results-info">
            <div class="info-item">
                <i class="bi bi-info-circle me-1"></i>
                Showing {{filteredProjects.length}} of {{totalItems}} projects
            </div>
            <div class="info-item">
                Page {{currentPage}} of {{totalPages}}
            </div>
        </div>

        <!-- Projects Grid -->
        <div class="projects-grid" *ngIf="filteredProjects.length > 0">
            <div class="project-card" *ngFor="let project of filteredProjects">
                <!-- Project Image -->
                <div class="project-image-container">
                    <img *ngIf="project.Image; else noImage" [src]="project.Image"
                        class="project-image" alt="{{project.Name}}" />
                    <ng-template #noImage>
                        <div class="no-image-placeholder">
                            <i class="bi bi-image"></i>
                        </div>
                    </ng-template>
                    <div class="price-badge">
                        <span>{{project.PriceUnit}}</span>
                    </div>
                </div>

                <!-- Card Body -->
                <div class="project-card-body">
                    <h5 class="project-title" [title]="project.Name">
                        {{project.Name}}
                    </h5>
                    <p class="project-description" [title]="project.Description">
                        {{project.Description | slice:0:100}}{{project.Description.length > 100 ? '...' : ''}}
                    </p>
                    <div class="project-meta">
                        <div class="project-price">
                            <i class="bi bi-currency-dollar me-1"></i>
                            {{formatPrice(project.ApproximatePrice)}} EGP
                        </div>
                        <small class="project-id">
                            ID: {{project.Id}}
                        </small>
                    </div>
                </div>

                <!-- Card Footer -->
                <div class="project-card-footer" *ngIf="providerId">
                    <button class="action-btn view-btn" (click)="openDetails(project)" type="button">
                        <i class="bi bi-eye"></i>
                        View
                    </button>
                    <button class="action-btn edit-btn" (click)="openEdit(project)" type="button">
                        <i class="bi bi-pencil"></i>
                        Edit
                    </button>
                    <button class="action-btn delete-btn" (click)="openDelete(project)" type="button">
                        <i class="bi bi-trash"></i>
                        Delete
                    </button>
                </div>
            </div>
        </div>

        <!-- Empty State -->
        <div *ngIf="filteredProjects.length === 0 && !isLoading" class="empty-state">
            <div class="empty-state-content">
                <i class="bi bi-folder-x empty-icon"></i>
                <h3 class="empty-title">No Projects Found</h3>
                <p class="empty-subtitle">
                    <span *ngIf="searchTerm">No projects match your search criteria.</span>
                    <span *ngIf="!searchTerm">You haven't created any projects yet.</span>
                </p>
                <button *ngIf="searchTerm" class="btn btn-primary" (click)="searchTerm = ''; onSearchChange()">
                    <i class="bi bi-arrow-clockwise me-2"></i>
                    Clear Search
                </button>
            </div>
        </div>

        <!-- Pagination -->
        <div class="pagination-style" *ngIf="totalPages > 1">
            <ul class="ngx-pagination">
                <li [class.disabled]="currentPage === 1">
                    <a (click)="changePage(1)" aria-label="First">
                        <i class="bi bi-chevron-double-left"></i>
                    </a>
                </li>
                <li [class.disabled]="currentPage === 1">
                    <a (click)="changePage(currentPage - 1)" aria-label="Previous">
                        <i class="bi bi-chevron-left"></i>
                    </a>
                </li>

                <li *ngFor="let page of getPageNumbers()" [class.current]="currentPage === page">
                    <a (click)="changePage(page)">{{page}}</a>
                </li>

                <li [class.disabled]="currentPage === totalPages">
                    <a (click)="changePage(currentPage + 1)" aria-label="Next">
                        <i class="bi bi-chevron-right"></i>
                    </a>
                </li>
                <li [class.disabled]="currentPage === totalPages">
                    <a (click)="changePage(totalPages)" aria-label="Last">
                        <i class="bi bi-chevron-double-right"></i>
                    </a>
                </li>
            </ul>
        </div>
    </div>
</div>

<!-- Modal Backdrop -->
<div class="modal-backdrop" *ngIf="showDetailsModal || showDeleteModal || showEditModal" (click)="closeModals()"></div>

<!-- View Details Modal -->
<div class="custom-modal" *ngIf="showDetailsModal">
    <div class="modal-container modal-lg">
        <div class="modal-header details-header">
            <h5 class="modal-title">
                <i class="bi bi-info-circle me-2"></i>
                Project Details
            </h5>
            <button type="button" class="modal-close-btn" (click)="closeModals()">
                <i class="bi bi-x-lg"></i>
            </button>
        </div>
        <div class="modal-body">
            <div class="row" *ngIf="selectedProject">
                <div class="col-md-6" *ngIf="selectedProject.Image">
                    <img [src]="selectedProject.Image" class="modal-image" alt="Project Image" />
                </div>
                <div class="col-md-6">
                    <h4 class="modal-project-title">{{selectedProject.Name}}</h4>
                    <div class="modal-field">
                        <label class="field-label">Description:</label>
                        <div class="field-content">{{selectedProject.Description}}</div>
                    </div>
                    <div class="row">
                        <div class="col-6">
                            <div class="modal-field">
                                <label class="field-label">Price:</label>
                                <div class="field-price">{{formatPrice(selectedProject.ApproximatePrice)}} EGP</div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="modal-field">
                                <label class="field-label">Unit:</label>
                                <div class="field-content">{{selectedProject.PriceUnit}}</div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-field">
                        <label class="field-label">Project ID:</label>
                        <div class="field-content">{{selectedProject.Id}}</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" (click)="closeModals()">
                <i class="bi bi-x-circle me-2"></i>
                Close
            </button>
            <button class="btn btn-warning" (click)="openEdit(selectedProject!); showDetailsModal = false;">
                <i class="bi bi-pencil me-2"></i>
                Edit Project
            </button>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="custom-modal" *ngIf="showDeleteModal">
    <div class="modal-container">
        <div class="modal-header delete-header">
            <h5 class="modal-title">
                <i class="bi bi-exclamation-triangle me-2"></i>
                Confirm Deletion
            </h5>
            <button type="button" class="modal-close-btn" (click)="closeModals()">
                <i class="bi bi-x-lg"></i>
            </button>
        </div>
        <div class="modal-body">
            <div class="delete-confirmation">
                <i class="bi bi-trash delete-icon"></i>
                <h5 class="delete-title">Are you sure you want to delete this project?</h5>
                <p class="delete-project-name">
                    Project: <strong>{{selectedProject?.Name}}</strong>
                </p>
                <div class="delete-warning">
                    <i class="bi bi-exclamation-triangle me-2"></i>
                    This action cannot be undone.
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" (click)="closeModals()" [disabled]="isDeleting">
                <i class="bi bi-x-circle me-2"></i>
                Cancel
            </button>
            <button class="btn btn-danger" (click)="confirmDelete()" [disabled]="isDeleting">
                <i class="bi bi-trash me-2" *ngIf="!isDeleting"></i>
                <span class="spinner-border spinner-border-sm me-2" *ngIf="isDeleting"></span>
                {{isDeleting ? 'Deleting...' : 'Yes, Delete'}}
            </button>
        </div>
    </div>
</div>

<!-- Edit Modal -->
<div class="custom-modal" *ngIf="showEditModal">
    <div class="modal-container modal-lg">
        <div class="modal-header edit-header">
            <h5 class="modal-title">
                <i class="bi bi-pencil me-2"></i>
                Edit Project
            </h5>
            <button type="button" class="modal-close-btn" (click)="closeModals()">
                <i class="bi bi-x-lg"></i>
            </button>
        </div>
        <div class="modal-body" *ngIf="selectedProject">
            <form #editForm="ngForm" class="edit-form">
                <div class="form-group">
                    <label class="form-label">Project Name</label>
                    <input type="text" class="form-control" name="Name" [(ngModel)]="selectedProject.Name" required />
                </div>

                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="form-control" name="Description" rows="3"
                        [(ngModel)]="selectedProject.Description" required></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Approximate Price</label>
                    <input type="number" class="form-control" name="ApproximatePrice"
                        [(ngModel)]="selectedProject.ApproximatePrice" required />
                </div>

                <div class="form-group">
                    <label class="form-label">Price Unit</label>
                    <select class="form-select" name="PriceUnit" [(ngModel)]="selectedProject.PriceUnit" required>
                        <option value="per_hour">Per Hour</option>
                        <option value="per_day">Per Project</option>
                    </select>
                </div>

                <div class="form-group text-center">
                    <label class="form-label">Current Image</label>
                    <div class="current-image-preview">
                        <img *ngIf="imagePreview || selectedProject.Image" [src]="imagePreview || selectedProject.Image"
                            class="preview-image" alt="Project Image" />
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Change Project Image</label>
                    <input type="file" class="form-control" accept="image/*" (change)="onEditImageSelected($event)" />
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-primary" [disabled]="editForm.invalid" (click)="submitEdit()">
                        <i class="bi bi-check-circle me-1"></i>
                        Save Changes
                    </button>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" (click)="closeModals()">
                <i class="bi bi-x-circle me-2"></i>
                Close
            </button>
        </div>
    </div>
</div>